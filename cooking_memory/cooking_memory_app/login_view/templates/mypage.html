{% extends 'base.html' %}

{% block title %}ãƒã‚¤ãƒšãƒ¼ã‚¸{% endblock %}
{% block content %}

{% load static %}
<link rel="stylesheet" href="{% static 'css/sanitize.css' %}">
<link rel="stylesheet" href="{% static 'css/style.css' %}">

<style>
  .main-content {
    margin-top: 100px; /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®é«˜ã•åˆ†ã ã‘ç©ºã‘ã‚‹ */
  }

  h1 {
    font-size: 60px;
    text-align: center;
  }

  img{
    width: 50%;
  }

  form div {
    font-size: 40px;
    margin-bottom: 10px;
    width: 100%;
    max-width: 700px; /* å…¥åŠ›æ¬„ã®å¹…ã‚’åˆ¶é™ */
  }
  div {
    font-size: 40px;
  }
  label {
    display: block;
    font-size: 60px;
  }
  input[type="submit"] {
    font-size: 50px;
    padding: 10px 30px;
  }
  .user-name {
    text-align: center;
    margin-top: 40px;
    font-size: 60px;
  }
  .mypage-list {
    margin-top: 50px;
    font-size: 60px;
  }
  .mypage-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid #ccc;
  }
  .menu-link,
  .arrow {
    color: black;
    text-decoration: none; /* ä¸‹ç·šæ¶ˆã—ãŸã„å ´åˆ */
  }
  #nameChangeModal {
    font-size: 40px;
    color: gray;
    margin-left: 10px;
    text-decoration: none;
  }

  {% comment %} .menu-link {
    display: inline-block;        /* æ¨ªå¹…ã¨é«˜ã•ã‚’æŒ‡å®šã§ãã‚‹è¡Œå†…è¦ç´ ã« */
    padding: 5px 5px;           /* ä¸Šä¸‹ã« pxã€å·¦å³ã« pxã®ä½™ç™½ */
    color: #333;                  /* æ–‡å­—ã®è‰²ï¼ˆ#333ã¯ãƒ€ãƒ¼ã‚¯ã‚°ãƒ¬ãƒ¼ï¼‰ */
    margin-top: 50px;             /* ä¸Šã«50pxã®ä½™ç™½ï¼ˆé›¢ã™ï¼‰ */
    } {% endcomment %}

</style>

<div class="main-content">
  {% comment %} <h1>ãƒã‚¤ãƒšãƒ¼ã‚¸</h1> {% endcomment %}
  <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ -->
  {% if user.image_url %}
    <div style="text-align: center;"><img src="{{ user.image_url.url }}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ"></div>
  {% else %}
    <p>ç”»åƒãŒã‚ã‚Šã¾ã›ã‚“</p>
  {% endif %}

  <form method="post" enctype="multipart/form-data" action="{% url 'accounts:upload_profile_image' %}">
    {% csrf_token %}
    <!-- ã“ã“ã«éš ã—fileInputã‚’è¨­ç½® -->
    <input type="file" id="fileInput" name="image_url" accept="image/*" style="display: none;">

    <div id="photoPreviewArea" style="margin-top: 1px;">
      <img id="photoPreview" src="" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" style="max-width: 100%; display: none;">
    </div>

    <button id="selectFromAlbum" type="submit" style="font-size: 60px; margin-bottom: 40px;">ï¼‹ç”»åƒã‚’ç™»éŒ²</button>
    {% comment %} <a style="font-size: 40px; text-align: center;"><input type="file" name="image"></a>
    <button type="submit" style="font-size: 50px; margin-top: 10px;">é¸æŠã—ãŸç”»åƒã‚’ç™»éŒ²</button> {% endcomment %}
  </form>

  <!-- åå‰/ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ  -->
  <div class="user-name">
    {{ user.username }}<button data-bs-toggle="modal" data-bs-target="#nameChangeModal" style="font-size: 50px; margin-left:20px">åå‰å¤‰æ›´</button>
  </div>

  <ul class="mypage-list">
    <div class="mypage-item">
      <a class="menu-link" href="{% url 'accounts:change_email' %}">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›´</a>
      <a href="{% url 'accounts:change_email' %}" target="_blank" class="arrow">ï¼</a>
    </div>
    <div class="mypage-item">
      <a class="menu-link" href="{% url 'accounts:change_password' %}">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</a>
      <a href="{% url 'accounts:change_password' %}" target="_blank" class="arrow">ï¼</a>
    </div>
    <div class="mypage-item">
      <a class="menu-link" href="{% url 'accounts:generate_invite' %}">æ‹›å¾…ç”¨URLã®ç™ºè¡Œ</a>
      <a href="{% url 'accounts:generate_invite' %}" target="_blank" class="arrow">ï¼</a>
    </div>
    <div class="mypage-item">
      <a class="menu-link" href="#" data-bs-toggle="modal" data-bs-target="#shareUsersModal" onclick="share_users()">å…±æœ‰ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼</a>
      <a href="#" data-bs-toggle="modal" data-bs-target="#shareUsersModal" onclick="share_users()" target="_blank" class="arrow">ï¼</a>
    </div>
  </ul>

  <!-- ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ -->
  <form method="post" action="{% url 'accounts:user_logout_2' %}">
    {% csrf_token %}
    <button style="font-size: 60px;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
  </form>
</div>


<!-- ãƒ¢ãƒ¼ãƒ€ãƒ«æœ¬ä½“ -->
<div class="modal fade" id="nameChangeModal" tabindex="-1" aria-labelledby="nameChangeModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="{% url 'accounts:change_username' %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="nameChangeModalLabel">åå‰/ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="é–‰ã˜ã‚‹"></button>
        </div>
        <div class="modal-body">
          <input type="text" name="username" value="{{ user.username }}" class="form-control">
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" style="font-size: 30px;">å¤‰æ›´</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="shareUsersModal" tabindex="-1" aria-labelledby="shareUsersModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="shareUsersModalLabel">å…±æœ‰ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="é–‰ã˜ã‚‹"></button>
        </div>
        <div class="modal-body">
          <!-- ã“ã“ã«å…±æœ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º -->
          <ul id="shareUsersList"></ul>
        </div>
      </div>
    </div>
  </div>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('fileInput');
    const previewImg = document.getElementById('photoPreview');
    const selectFromAlbumBtn = document.getElementById('selectFromAlbum');
  
    // ğŸ“·ãƒœã‚¿ãƒ³æŠ¼ã—ãŸã‚‰ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚’é–‹ã
    selectFromAlbumBtn.addEventListener('click', function() {
      console.log('ğŸ“·ãƒœã‚¿ãƒ³æŠ¼ã•ã‚ŒãŸ');
      fileInput.click();
    });

    // fileInputã§ãƒ•ã‚¡ã‚¤ãƒ«é¸ã‚“ã ã‚‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
    fileInput.addEventListener('change', function(event) {
      console.log('ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã•ã‚ŒãŸ');
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          console.log('èª­ã¿è¾¼ã¿å®Œäº†');
          previewImg.src = e.target.result;
          previewImg.style.display = 'block'; // è¡¨ç¤ºã•ã›ã‚‹
        };
        reader.readAsDataURL(file);
      }
    });
  });

  function share_users() {
      fetch("{% url 'accounts:share_users' %}")
          .then(response => response.json())
          .then(data => {
              const userListDiv = document.getElementById("shareUsersList");
              userListDiv.innerHTML = "";// æ—¢å­˜ã®ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢

              if (data.users.length > 0) {                  
                  data.users.forEach(user => {
                    const li = document.createElement("li");
                    li.textContent = user.name;
                    userListDiv.appendChild(li);
               });
              } else {
                  userListDiv.innerHTML = "<p>å…±æœ‰ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã„ã¾ã›ã‚“ã€‚</p>";
              }
          })
          .catch(error => {
              document.getElementById("shareUsersList").innerHTML = "<p>èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>";
              console.error("ã‚¨ãƒ©ãƒ¼:", error);
          });
  }
  </script>

{% endblock %}