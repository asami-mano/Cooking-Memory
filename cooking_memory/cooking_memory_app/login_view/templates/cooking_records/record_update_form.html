{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
  <form method="post" action="{% url 'cooking_records:cooking_record_update' form.instance.pk %}" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.non_field_errors }}


    {% if form.errors %}
    <div class="alert alert-danger">
        <strong>ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™</strong>
        <ul>
        {% for field in form %}
            {% for error in field.errors %}
            <li>{{ field.label }}: {{ error }}</li>
            {% endfor %}
        {% endfor %}
        {% for error in form.non_field_errors %}
            <li>{{ error }}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}


    <!-- å†™çœŸãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
    {% if form.instance.image_url %}
      <div class="mb-3">
        <img src="{{ form.instance.image_url.url }}" alt="çŒ®ç«‹å†™çœŸ" style="max-width: 100%; height: auto;">
      </div>
    {% endif %}

    <!-- å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
    <div class="mb-3">
      {{ form.image_url.label_tag }}
      {{ form.image_url }}
      {{ form.image_url.errors }}
    </div>

    <!-- æ—¥ä»˜ -->
    <div class="mb-3">
      {{ form.date.label_tag }}
      {{ form.date }}
      {{ form.date.errors }}
    </div>

    <!-- ã‚«ãƒ†ã‚´ãƒª -->
    <div class="mb-3">
      {{ form.cooking_category.label_tag }}
      {{ form.cooking_category }}
      {{ form.cooking_category.errors }}
    </div>

    <!-- èª¿ç†ã®æ‰‹è»½ã• -->
    <div class="mb-3">
      {{ form.cooking_easiness.label_tag }}
      {{ form.cooking_easiness }}
      {{ form.cooking_easiness.errors }}
    </div>

    <!-- ãŠæ°—ã«å…¥ã‚Šï¼ˆâ™¡ãƒœã‚¿ãƒ³ï¼‰ -->
    <div class="mb-3">
      <label>ãŠæ°—ã«å…¥ã‚Š</label><br>
      <button type="button" id="favorite-btn" data-url="{% url 'cooking_records:toggle_favorite' pk=form.instance.pk %}" class="btn btn-link" style="font-size: 2rem;">
        {% if form.instance.is_favorite %}
            â¤ï¸
        {% else %}
            ğŸ¤
        {% endif %}
      </button>
    </div>

    <!-- ãƒ¡ãƒ¢ -->
    <div class="mb-3">
      {{ form.memo.label_tag }}
      {{ form.memo }}
      {{ form.memo.errors }}
    </div>

    <!-- å‚è€ƒãƒ¬ã‚·ãƒ”ï¼ˆã‚‚ã—å¿…è¦ãªã‚‰è¿½åŠ ï¼‰ -->
    {# å¿…è¦ã«å¿œã˜ã¦ã“ã“ã«ãƒ¬ã‚·ãƒ”ãƒªã‚¹ãƒˆã¨ã‹ #}

    <button type="submit" class="btn btn-primary">æ›´æ–°</button>
  </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
      const favoriteBtn = document.getElementById('favorite-btn');
      if (favoriteBtn) {
        favoriteBtn.addEventListener('click', function() {
          const url = favoriteBtn.dataset.url;
    
          fetch(url, {
            method: 'POST',
            headers: {
              'X-CSRFToken': '{{ csrf_token }}',
              'Content-Type': 'application/json',
            },
          })
          .then(response => response.json())
          .then(data => {
            if (data.is_favorite) {
              favoriteBtn.innerHTML = 'â¤ï¸';
            } else {
              favoriteBtn.innerHTML = 'ğŸ¤';
            }
          })
          .catch(error => {
            console.error('ã‚¨ãƒ©ãƒ¼:', error);
          });
        });
      }
    });
</script>
    
{% endblock %}
