{% extends 'base.html' %}
{% block content %}

<style>
  form {
      display: flex;
      flex-direction: column;
      align-items: center; /* å­è¦ç´ ï¼ˆå…¥åŠ›æ¬„ãƒ»ãƒœã‚¿ãƒ³ï¼‰ã‚’ä¸­å¤®ã« */
      margin-top: 5%;
  }

  form div {
      margin-bottom: 50px;
      width: 100%;
      max-width: 800px; /* å…¥åŠ›æ¬„ã®å¹…ã‚’åˆ¶é™ */
  }
  label {
      display: block;
      font-size: 60px;
  }

  .form-group {
    font-size: 60px;
    font-weight: bold;
    margin-bottom: 50px;
  }

  .form-group label {
    margin-bottom: 6px;
    font-weight: bold;
  }

  .form-group textarea {
    width: 80%;
    padding: 8px;
    border-radius: 8px;
  }

  .star-rating {
    display: inline-flex;#æ¨ªä¸¦ã³ã«ã™ã‚‹
    gap: 4px;#æ˜Ÿã®é–“ã«4pxã®éš™é–“
    direction: ltr;
    font-size: 60px;
  }
  .star-rating input[type="radio"] {
    display: none;
  }
  .star-rating label {
    font-size: 100px;
    color: #ccc;
    cursor: pointer;
  }
  .star-rating input[type="radio"]:checked ~ label {
    color:rgb(8, 6, 0);
  }
  .star-rating label:hover,
  .star-rating label:hover ~ label {
    color: #f5c518;
  }

  .easiness-labels {
    font-size: 32px;
    margin-top: 10px;
    text-align: center;
  }

  .favorite-btn {
    font-size: 100px;
    background: none;
    border: none;
    cursor: pointer;
  }

  button[type="submit"] {
    font-size: 60px;
    padding: 10px 30px;
}

  .easiness-labels {
    margin-top: 5px;
    font-size: 30px;
  }

  #open-category-modal {
    font-size: 30px;
    color: gray;
    margin-left: 10px;
    text-decoration: none;
  }

</style>

<form method="post" enctype="multipart/form-data">
  {% csrf_token %}

  <div>
      {{ form.image_url.label }} {{ form.image_url }}
  </div>
  <div class="form-group">
    {{ form.date.label }} {{ form.date }}
  </div>
  <div class="form-group">
    {{ form.cooking_category.label }} {{ form.cooking_category }}
    <a href="#" id="open-category-modal">ï¼‹æ–°è¦ä½œæˆ</a>
  </div>
  <div class="form-group">
    <label>èª¿ç†ã®æ‰‹è»½ã•</label>
    <div class="star-rating">
      <input type="radio" id="easiness-3" name="cooking_easiness" value="2">
      <label for="easiness-3">â˜…</label>

      <input type="radio" id="easiness-2" name="cooking_easiness" value="1" checked>
      <label for="easiness-2">â˜…</label>

      <input type="radio" id="easiness-1" name="cooking_easiness" value="0">
      <label for="easiness-1">â˜…</label>
    </div>
    <div class="easiness-labels">
      <span>â˜…ç°¡å˜  â˜…â˜…æ™®é€š  â˜…â˜…â˜…æ‰‹é–“ãŒã‹ã‹ã‚‹</span>
    </div>
  </div>
  <div class="form-group">
    <label>ãŠæ°—ã«å…¥ã‚Š</label>
    <button class="favorite-btn">ğŸ¤</button>
  </div>
  <div class="form-group">
    {{ form.memo.label }}<br> 
    {{ form.memo }}
  </div>

  <button type="submit">ç™»éŒ²</button>
</form>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ«æœ¬ä½“ -->
<div id="category-modal" style="display:none; position:fixed; top:30%; left:30%; background:#fff; border:1px solid #ccc; padding:20px;">
  <h3>æ–°è¦ã‚«ãƒ†ã‚´ãƒª</h3>
  <form id="category-form">
    {% csrf_token %}
    <input type="text" id="new-category-name" placeholder="ã‚«ãƒ†ã‚´ãƒªå" required><br>
    <button type="submit">ä½œæˆ</button>
    <button type="button" onclick="closeModal()" style="position:absolute; top:5px; right:10px; border:none; background:none; font-size:20px; cursor:pointer;">âœ–ï¸</button>
  </form>
</div>

<script>
  document.getElementById("open-category-modal").addEventListener("click", function(e) {
    e.preventDefault();
    document.getElementById("category-modal").style.display = "block";
  });
  
  function closeModal() {
    document.getElementById("category-modal").style.display = "none";
  }
  
  // æ–°è¦ã‚«ãƒ†ã‚´ãƒªä½œæˆ
  document.getElementById("category-form").addEventListener("submit", function(e) {
    e.preventDefault();
    const name = document.getElementById("new-category-name").value;
  
    fetch(`/cooking_records/create_category/`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": "{{ csrf_token }}",
      },
      body: JSON.stringify({ name: name }),
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        // ã‚»ãƒ¬ã‚¯ãƒˆã«è¿½åŠ 
        const select = document.getElementById("id_cooking_category");
        const option = document.createElement("option");
        option.value = data.id;
        option.text = data.name;
        option.selected = true;
        select.appendChild(option);
  
        closeModal();
      } else {
        alert("ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ");
      }
    });
  });

  </script>
  
  {% endblock  %}